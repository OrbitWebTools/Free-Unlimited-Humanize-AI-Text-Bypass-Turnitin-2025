<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#ffffff">
    <meta name="robots" content="index, follow">
    
    <title>MemePro | Advanced Apology Form Generator</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        /* --- ULTRA PREMIUM WHITE THEME --- */
        :root {
            --bg: #f8fafc;
            --surface: #ffffff;
            --primary: #2563eb;       /* Royal Blue */
            --accent: #f59e0b;        /* Amber for Highlights */
            --text: #0f172a;
            --border: #e2e8f0;
            --shadow: 0 4px 20px -5px rgba(0,0,0,0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Inter', sans-serif;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
        }

        /* Sticky Nav */
        nav {
            width: 100%; padding: 1rem;
            background: rgba(255,255,255,0.9); backdrop-filter: blur(8px);
            border-bottom: 1px solid var(--border);
            text-align: center; position: sticky; top: 0; z-index: 100;
        }
        .logo { font-size: 1.2rem; font-weight: 900; letter-spacing: -0.5px; }
        .logo span { color: var(--primary); }

        /* AD SPACES */
        .ad-zone { width: 100%; display: flex; justify-content: center; margin: 15px 0; background: #f1f5f9; padding: 5px; }

        /* MAIN UI GRID */
        .app-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            width: 100%; max-width: 1200px;
            padding: 20px;
        }
        
        @media(min-width: 900px) {
            .app-container { grid-template-columns: 350px 1fr; align-items: start; }
        }

        /* CONTROLS PANEL */
        .controls {
            background: var(--surface); border-radius: 16px;
            padding: 1.5rem; box-shadow: var(--shadow); border: 1px solid var(--border);
        }

        h3 { font-size: 0.85rem; text-transform: uppercase; color: #64748b; margin-bottom: 10px; font-weight: 700; letter-spacing: 0.5px; }

        input[type="text"], input[type="date"] {
            width: 100%; padding: 12px; margin-bottom: 15px;
            border: 1px solid var(--border); border-radius: 8px;
            background: #f8fafc; font-size: 1rem; outline: none; transition: 0.2s;
        }
        input:focus { border-color: var(--primary); background: #fff; }

        /* SMART ACTION BAR (The Magic Tools) */
        .smart-actions {
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
            margin-bottom: 20px;
        }
        .action-btn {
            background: var(--surface); border: 1px solid var(--border);
            padding: 12px; border-radius: 10px; font-weight: 600; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 8px;
            transition: 0.2s; color: var(--text);
        }
        .action-btn:hover { background: var(--primary); color: white; border-color: var(--primary); }
        .action-btn.active { background: var(--primary); color: white; }

        /* SIZE SLIDER (Hidden by default) */
        .resizer-box {
            background: #eff6ff; border: 1px solid #bfdbfe;
            padding: 15px; border-radius: 10px; margin-top: 15px;
            display: none; /* Shows when item selected */
        }
        .resizer-box.show { display: block; animation: popIn 0.2s ease; }
        
        @keyframes popIn { from{opacity:0; transform:translateY(-5px)} to{opacity:1; transform:translateY(0)} }

        input[type="range"] { width: 100%; cursor: pointer; accent-color: var(--primary); }

        /* CANVAS AREA */
        .canvas-area {
            display: flex; flex-direction: column; align-items: center;
        }
        
        canvas {
            background: white; border-radius: 4px;
            box-shadow: 0 15px 50px -10px rgba(0,0,0,0.2);
            max-width: 100%; cursor: grab;
            touch-action: none; /* Prevents scroll on mobile */
        }
        canvas:active { cursor: grabbing; }

        .btn-download {
            margin-top: 20px; width: 100%; max-width: 400px;
            padding: 15px; background: var(--text); color: white;
            border: none; border-radius: 50px; font-size: 1.1rem; font-weight: 800;
            cursor: pointer; box-shadow: 0 10px 20px -5px rgba(0,0,0,0.2);
            transition: 0.2s;
        }
        .btn-download:hover { transform: scale(1.02); background: var(--primary); }

        /* Radio Inputs */
        .radio-stack { display: flex; flex-direction: column; gap: 8px; }
        .radio-opt {
            display: flex; align-items: center; gap: 10px; padding: 10px;
            border: 1px solid var(--border); border-radius: 8px; cursor: pointer;
        }
        .radio-opt:hover { background: #f1f5f9; }
        .radio-opt input { accent-color: var(--primary); width: 18px; height: 18px; }

    </style>
</head>
<body>

    <nav>
        <div class="logo">Meme<span>Pro</span></div>
    </nav>

    <div class="ad-zone">
        <script type="text/javascript">
            atOptions = {
                'key' : 'da1a352c776635fa7984cd1fb95c4041',
                'format' : 'iframe',
                'height' : 90,
                'width' : 728,
                'params' : {}
            };
        </script>
        <script type="text/javascript" src="//www.highperformanceformat.com/da1a352c776635fa7984cd1fb95c4041/invoke.js"></script>
    </div>

    <div class="app-container">
        
        <div class="controls">
            <h3>1. Form Details</h3>
            <input type="text" id="targetName" placeholder="Apologizing To (e.g. Kohli)" maxlength="20">
            <input type="text" id="signerName" placeholder="Signed By (Your Name)" maxlength="20">
            <input type="date" id="datePicker">

            <h3>2. Select Reason</h3>
            <div class="radio-stack">
                <label class="radio-opt"><input type="radio" name="reason" value="I wasn't familiar with your game" checked> I wasn't familiar with your game</label>
                <label class="radio-opt"><input type="radio" name="reason" value="I listened to the haters"> I listened to the haters</label>
            </div>

            <hr style="border:0; border-top:1px solid #e2e8f0; margin: 20px 0;">

            <h3>3. Add Custom Elements</h3>
            <div class="smart-actions">
                <button class="action-btn" onclick="addText()"><span>T</span> Text</button>
                <button class="action-btn" onclick="document.getElementById('imgInp').click()"><span>üñºÔ∏è</span> Photo</button>
                <input type="file" id="imgInp" accept="image/*" style="display:none">
            </div>

            <div id="smartResizer" class="resizer-box">
                <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                    <strong>üìè Resize Item</strong>
                    <button onclick="deleteSelected()" style="background:none; border:none; color:red; font-weight:bold; cursor:pointer;">üóëÔ∏è Delete</button>
                </div>
                <input type="range" id="sizeSlider" min="20" max="300" value="100">
            </div>
            
        </div>

        <div class="canvas-area">
            <canvas id="memeCanvas" width="500" height="650"></canvas>
            
            <button class="btn-download" id="dlBtn">‚¨áÔ∏è Download HD Image</button>

            <div class="ad-zone" style="margin-top:20px; background:transparent;">
                <script type="text/javascript">
                    atOptions = {
                        'key' : 'eea17f69018ec26e6e52c77738858670',
                        'format' : 'iframe',
                        'height' : 250,
                        'width' : 300,
                        'params' : {}
                    };
                </script>
                <script type="text/javascript" src="//www.highperformanceformat.com/eea17f69018ec26e6e52c77738858670/invoke.js"></script>
            </div>
        </div>

    </div>

    <script type='text/javascript' src='//pl28120871.effectivegatecpm.com/b8/2a/fe/b82afee8cc534f12fba12741bfb629a1.js'></script>

    <script>
        // üí∞ DIRECT LINK (New Tab Ad)
        const DIRECT_LINK = "https://www.effectivegatecpm.com/wtv8888v?key=d837f9dc7c48bf7b0d830d9f0d04a531";

        const canvas = document.getElementById('memeCanvas');
        const ctx = canvas.getContext('2d');
        const sliderBox = document.getElementById('smartResizer');
        const sizeSlider = document.getElementById('sizeSlider');
        
        // Smart Object System
        let objects = []; 
        let selectedId = null;
        let isDrag = false;
        let startX, startY;

        // Inputs
        const inputs = [
            document.getElementById('targetName'),
            document.getElementById('signerName'),
            document.getElementById('datePicker')
        ];
        document.getElementById('datePicker').valueAsDate = new Date();

        // --- CORE DRAWING ENGINE ---
        function draw() {
            // 1. Clear
            ctx.fillStyle = "#ffffff";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 2. Official Form Base
            ctx.strokeStyle = "#0f172a";
            ctx.lineWidth = 3;
            ctx.strokeRect(20, 20, 460, 610);
            ctx.lineWidth = 1;
            ctx.strokeRect(25, 25, 450, 600);

            // 3. Header
            ctx.fillStyle = "#0f172a";
            ctx.textAlign = "center";
            ctx.font = "bold 28px 'Courier Prime', monospace";
            ctx.fillText("OFFICIAL APOLOGY FORM", 250, 80);
            ctx.beginPath(); ctx.moveTo(50, 95); ctx.lineTo(450, 95); ctx.lineWidth=2; ctx.stroke();

            // 4. Static Text
            ctx.textAlign = "left";
            ctx.font = "bold 18px 'Courier Prime', monospace";
            ctx.fillText("TO: " + (inputs[0].value.toUpperCase() || "_______"), 50, 140);
            
            ctx.font = "16px 'Courier Prime', monospace";
            ctx.fillText("I owe you an apology because:", 50, 180);

            // 5. Reasons
            const reasons = document.getElementsByName('reason');
            let y = 220;
            reasons.forEach(r => {
                ctx.lineWidth = 1;
                ctx.strokeStyle = "#0f172a";
                ctx.strokeRect(50, y-15, 20, 20);
                if(r.checked) {
                    ctx.font = "bold 20px Arial";
                    ctx.fillText("‚úì", 52, y+2);
                }
                ctx.font = "14px 'Courier Prime', monospace";
                ctx.fillText(r.value, 80, y);
                y += 45;
            });

            // 6. Signature
            ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(50, 560); ctx.lineTo(250, 560); ctx.stroke();
            ctx.font = "16px 'Courier Prime', monospace";
            ctx.fillText("SIGNED: " + (inputs[1].value || ""), 50, 585);
            ctx.fillText("DATE: " + inputs[2].value, 300, 585);

            // 7. RENDER CUSTOM OBJECTS
            objects.forEach((obj, index) => {
                ctx.save();
                if(obj.type === 'text') {
                    ctx.font = `bold ${obj.size}px 'Courier Prime'`;
                    ctx.fillStyle = "#dc2626"; // Stamp Color
                    ctx.fillText(obj.text, obj.x, obj.y);
                    
                    // Selection Border
                    if(index === selectedId) {
                        const dims = ctx.measureText(obj.text);
                        ctx.strokeStyle = "#2563eb"; ctx.lineWidth = 1; ctx.setLineDash([5, 3]);
                        ctx.strokeRect(obj.x - 5, obj.y - obj.size, dims.width + 10, obj.size + 10);
                    }
                } else if(obj.type === 'img') {
                    ctx.drawImage(obj.img, obj.x, obj.y, obj.w, obj.h);
                    
                    // Selection Border
                    if(index === selectedId) {
                        ctx.strokeStyle = "#2563eb"; ctx.lineWidth = 2; ctx.setLineDash([5, 3]);
                        ctx.strokeRect(obj.x, obj.y, obj.w, obj.h);
                    }
                }
                ctx.restore();
            });
        }

        // --- SMART LOGIC: RESIZING & DRAGGING ---
        
        function getPos(e) {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            return { x: (clientX - rect.left) * scaleX, y: (clientY - rect.top) * scaleY };
        }

        function isHit(pos, obj) {
            if(obj.type === 'text') {
                ctx.font = `bold ${obj.size}px 'Courier Prime'`;
                const w = ctx.measureText(obj.text).width;
                return pos.x >= obj.x && pos.x <= obj.x + w && pos.y >= obj.y - obj.size && pos.y <= obj.y;
            } else {
                return pos.x >= obj.x && pos.x <= obj.x + obj.w && pos.y >= obj.y && pos.y <= obj.y + obj.h;
            }
        }

        // Handle Select/Drag
        function handleStart(e) {
            if(e.touches) e.preventDefault(); // Stop Scroll
            const pos = getPos(e);
            
            // Reverse loop (select top-most)
            let hitFound = false;
            for(let i=objects.length-1; i>=0; i--) {
                if(isHit(pos, objects[i])) {
                    selectedId = i;
                    startX = pos.x;
                    startY = pos.y;
                    isDrag = true;
                    hitFound = true;
                    
                    // Show Smart Resizer logic
                    sliderBox.classList.add('show');
                    if(objects[i].type === 'text') sizeSlider.value = objects[i].size;
                    if(objects[i].type === 'img') sizeSlider.value = objects[i].w;
                    
                    break;
                }
            }
            if(!hitFound) {
                selectedId = null;
                sliderBox.classList.remove('show');
            }
            draw();
        }

        function handleMove(e) {
            if(!isDrag || selectedId === null) return;
            if(e.touches) e.preventDefault();
            
            const pos = getPos(e);
            const dx = pos.x - startX;
            const dy = pos.y - startY;
            
            objects[selectedId].x += dx;
            objects[selectedId].y += dy;
            
            startX = pos.x;
            startY = pos.y;
            draw();
        }

        function handleEnd() { isDrag = false; }

        // --- SMART CONTROLS ---
        
        // 1. Add Text
        window.addText = () => {
            const t = prompt("Enter Text:");
            if(t) {
                objects.push({ type: 'text', text: t, x: 250, y: 300, size: 24 });
                selectedId = objects.length - 1;
                draw();
            }
        };

        // 2. Add Image
        document.getElementById('imgInp').addEventListener('change', (e) => {
            if(e.target.files && e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = (evt) => {
                    const img = new Image();
                    img.onload = () => {
                        objects.push({ type: 'img', img: img, x: 200, y: 250, w: 150, h: 150 * (img.height/img.width) });
                        selectedId = objects.length - 1;
                        sliderBox.classList.add('show');
                        sizeSlider.value = 150;
                        draw();
                    };
                    img.src = evt.target.result;
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        });

        // 3. Slider Logic (Resize)
        sizeSlider.addEventListener('input', (e) => {
            if(selectedId === null) return;
            const val = parseInt(e.target.value);
            const obj = objects[selectedId];
            
            if(obj.type === 'text') {
                obj.size = val; // Change Font Size
            } else {
                const ratio = obj.h / obj.w;
                obj.w = val; // Change Width
                obj.h = val * ratio; // Maintain Aspect Ratio
            }
            draw();
        });

        // 4. Delete Logic
        window.deleteSelected = () => {
            if(selectedId !== null) {
                objects.splice(selectedId, 1);
                selectedId = null;
                sliderBox.classList.remove('show');
                draw();
            }
        };

        // --- LISTENERS ---
        canvas.addEventListener('mousedown', handleStart);
        canvas.addEventListener('touchstart', handleStart, {passive: false});
        canvas.addEventListener('mousemove', handleMove);
        canvas.addEventListener('touchmove', handleMove, {passive: false});
        canvas.addEventListener('mouseup', handleEnd);
        canvas.addEventListener('touchend', handleEnd);

        // Update Text
        inputs.forEach(i => i.addEventListener('input', draw));
        document.getElementsByName('reason').forEach(r => r.addEventListener('change', draw));

        // Initial Draw
        document.fonts.ready.then(draw);
        setTimeout(draw, 500);

        // --- DOWNLOAD & AD ---
        document.getElementById('dlBtn').addEventListener('click', () => {
            selectedId = null; draw(); // Clear selection border
            
            if(DIRECT_LINK) window.open(DIRECT_LINK, '_blank');
            
            setTimeout(() => {
                const link = document.createElement('a');
                link.download = "MemePro_Export.png";
                link.href = canvas.toDataURL('image/png', 1.0);
                link.click();
            }, 500);
        });

    </script>
</body>
</html>
